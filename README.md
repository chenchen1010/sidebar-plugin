# 多维表格边栏插件：批量图片上传

把 `batch_image_upload.py` 的能力搬到多维表格边栏：按子文件夹名称匹配记录，把图片批量写入附件/图片字段，支持封面优先、数字排序。

## 快速开始

```bash
cd sidebar-plugin
npm install
npm run dev -- --host 0.0.0.0 --port 5173  # 建议指定 host 方便在飞书内访问
```

在多维表格左侧「插件」面板点击「自定义插件」→「新增插件」，填入运行地址（本地开发可用 `http://localhost:5173/` 或 `http://你的局域网IP:5173/`），即可加载边栏。

生产部署可执行 `npm run build`，将 `dist` 目录部署到任意可访问的静态服务。

## 使用步骤

1. 打开插件后，选择「匹配字段」：子文件夹名称将与该字段值完全匹配，用来定位记录行。
2. 选择「上传字段」：附件/图片字段，图片会写入这里。
3. 设置「每行最多上传」数量（默认 10）。
4. 点击「选择文件夹」，选择父目录（包含多个子文件夹）。也可直接拖拽文件夹进入区域。
5. 点击「开始上传」查看日志。未匹配到记录的子文件夹会被跳过。

## 规则与行为

- 只处理图片：`jpg`、`jpeg`、`png`、`gif`、`bmp`、`webp`。
- 子文件夹名称需与匹配字段值完全一致（区分大小写）。
- 上传顺序：文件名包含“商品主图”的优先，其次按文件名中的数字从小到大，最后其他按名称排序。
- 每行超过上限的图片会被自动截断。
- 插件在前端运行，使用当前登录用户在多维表格中的权限。

## 与 Python 脚本的对应关系

- `batch_upload_config.json` 中的 `match_field_name` 和 `upload_field_name` 在插件内通过下拉选择。
- `parent_folder_path` 由文件夹选择器提供（支持 `webkitdirectory` 读取子目录）。
- 上传逻辑、命名排序规则与原脚本保持一致。

## 常见问题

- 如果附件字段不允许写入，确认当前账号在表格内有编辑权限。
- 拖拽文件夹时，部分浏览器可能不给出目录结构，若未识别到子文件夹，请改用「选择文件夹」按钮。
- 如需修改支持的图片格式，可在 `src/App.tsx` 的 `SUPPORTED_IMAGE_EXTS` 常量中调整。

